<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ðŸŽ¥ AI Detector</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
<style>
:root { --accent: #00ffcc; --bg: #0f0f0f; --panel: #1c1c1c; }
body {
    background: var(--bg);
    color: #fff;
    font-family: 'Segoe UI', sans-serif;
    text-align: center;
    margin: 0;
    padding: 0;
    overflow-x: hidden;
}

/* --- Background Image --- */
.background {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: url('https://www.shutterstock.com/image-photo/robot-point-ip-wifi-wireless-260nw-2436041459.jpg') no-repeat center center;
    background-size: cover;
    filter: blur(12px) brightness(0.4);
    z-index: -1;
}

/* --- Header --- */
header { display: flex; justify-content: space-between; align-items: center; padding: 10px 20px; }
h1 { color: var(--accent); margin: 0; }
.logout-btn { background: transparent; color: red; border: none; font-size: 1.5rem; cursor: pointer; }
.logout-btn:hover { color: #ff4444; }

/* --- Video & Canvas --- */
video, canvas { border-radius: 12px; }
video#video { width: 640px; height: 480px; border: 3px solid var(--accent); margin-top: 20px; }

/* --- Controls --- */
.controls { margin-top: 15px; }
button { background: var(--accent); color: #000; border: none; padding: 10px 20px; margin: 10px; border-radius: 10px; cursor: pointer; font-weight: bold; transition: 0.3s; box-shadow: 0 0 15px #00ffcc, 0 0 30px #00ffcc; }
button:hover { background: #00ccaa; box-shadow: 0 0 25px #00ffcc, 0 0 50px #00ffcc; }

#faces-container { display: flex; flex-wrap: wrap; justify-content: center; margin-top: 15px; }
.face-box { border: 2px solid var(--accent); border-radius: 8px; margin: 5px; padding: 5px; background: var(--panel); }

#info { margin-top: 10px; color: #aaa; }

#gallery { display: none; } /* hide gallery completely since we won't show videos */

footer { margin-top: 40px; color: #666; }
</style>
</head>
<body>

<div class="background"></div>

<header>
    <center><h1 >ðŸŽ¥ AI Camera Detector</h1></center>
    <form action="/logout/" method="post" style="margin:0;">
        {% csrf_token %}
        <button type="submit" class="logout-btn" title="Logout">
            <i class="bi bi-box-arrow-right"></i>
        </button>
    </form>
</header>

<p>Welcome, {{ user.username }} ðŸ‘‹</p>

<video id="video" autoplay muted></video>
<canvas id="canvas" width="640" height="480" style="display:none;"></canvas>

<div class="controls">
    <button id="captureImg"><i class="bi bi-camera-fill"></i> Capture Image</button>
    <button id="startRec"><i class="bi bi-camera-reels-fill"></i> Record Video</button>
    <button id="stopRec"><i class="bi bi-stop-circle-fill"></i> Stop</button>
</div>

<div id="faces-container"></div>
<p id="info">Detecting faces and objects every 5 seconds...</p>

<div id="gallery"></div>

<footer>ðŸ§  Powered by AI Vision | {{ now }}</footer>

<script>
const video = document.getElementById('video');
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
const facesContainer = document.getElementById('faces-container');

let mediaRecorder;
let recordedChunks = [];

// Start camera
navigator.mediaDevices.getUserMedia({ video: true, audio: true })
.then(stream => { 
    video.srcObject = stream; 
    window.localStream = stream;
})
.catch(err => { alert("Camera access denied: " + err); });

// Auto detect faces and objects (simulation)
setInterval(() => { detectFacesObjects(); }, 5000);

function detectFacesObjects() {
    ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
    const detectedFaces = Math.floor(Math.random() * 5);
    const detectedObjects = Math.floor(Math.random() * 4);
    const timestamp = new Date().toLocaleString();

    for (let i=0; i<detectedFaces; i++) {
        ctx.strokeStyle = 'lime';
        ctx.lineWidth = 2;
        ctx.strokeRect(Math.random()*500, Math.random()*400, 50, 50);
    }
    for (let i=0; i<detectedObjects; i++) {
        ctx.strokeStyle = 'yellow';
        ctx.lineWidth = 2;
        ctx.strokeRect(Math.random()*500, Math.random()*400, 60, 60);
    }

    facesContainer.innerHTML = `
        <div class="face-box">
            <p>ðŸ•’ ${timestamp}</p>
            <p>Detected Faces: ${detectedFaces}</p>
            <p>Detected Objects: ${detectedObjects}</p>
        </div>
    `;
}

// Capture Image
document.getElementById('captureImg').addEventListener('click', () => {
    ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
    const dataURL = canvas.toDataURL('image/png');
    download(dataURL, `capture-${Date.now()}.png`);
});

// Video recording
document.getElementById('startRec').addEventListener('click', () => {
    recordedChunks = [];
    if (!window.localStream) return alert('Camera not ready');
    mediaRecorder = new MediaRecorder(window.localStream, { mimeType: 'video/webm; codecs=vp9' });
    mediaRecorder.ondataavailable = e => { if(e.data.size>0) recordedChunks.push(e.data); };
    mediaRecorder.onstop = saveVideo;
    mediaRecorder.start();
    alert('Recording started!');
});

document.getElementById('stopRec').addEventListener('click', () => {
    if(mediaRecorder && mediaRecorder.state==='recording') mediaRecorder.stop();
    alert('Recording stopped!');
});

// Save video WITHOUT adding to gallery
function saveVideo() {
    const blob = new Blob(recordedChunks, { type:'video/webm' });
    const url = URL.createObjectURL(blob);
    // Do not show in UI
    download(url, `video-${Date.now()}.webm`);
}

// Download helper
function download(data, filename) {
    const a = document.createElement('a');
    a.href = data;
    a.download = filename;
    a.click();
}
</script>

</body>
</html>
